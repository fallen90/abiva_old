<section>
    <div class="row">
        <div class="col-xs-6" style="  overflow-wrap: break-word; white-space: pre-wrap;  width: 80%;
  margin-left: 90px;">
        </div>
        <div class="col-xs-12 ">
            <div class="box box-blue" id="selection">
            </div>
            <img class="solution" src='abiva_assets/correct.png'>
        </div>
    </div>
    <a href="#" class="btn_done"> Done </a>
    <div class="overlay_in" style="width: 100%;height: 100%;position: absolute;top: 0px;right: 0px; background-color:rgba(0,0,0,.5); z-index: 100000;">
        <div class="overlay_content">
            <h1 style="  font-size: 60px;font-family: 'Montserrat', sans-serif; font-weight: bold;margin-top: 220px;">Are you done with all of the questions?</h1>
            <a href="#" class="btn_box_end yes" style="margin-top:50px;margin-left:20px">YES</a>
            <a href="#" class="btn_box_end no" style="margin-top:50px;margin-left:20px">NO</a>
        </div>
    </div>
    <div class="overlay_scoring" style="width: 100%;height: 100%;position: absolute;top: 0px;right: 0px; background-color:rgba(0,0,0,.5); z-index: 100000;">
        <img class="close_btn" src="abiva_assets/close.png" style="  position: absolute;top: 28px;right: 101px;width: 62px;height: 60px; cursor:pointer;">
        <div class="overlay_content_scoring" style=" width: 80%; height: 81%;position: absolute;top: 80px;left: 145px;">
            <h1 class="score" style="font-size: 68px;position: absolute;font-family: 'Montserrat', sans-serif;font-weight: bolder;top: 205px;left: 455px;color: #EDEDB1;">0</h1>
            <img src="abiva_assets/catchup.png" wdith="100%" height="100%">
        </div>
    </div>
     <div class="change_page_btns">
      <span id="arrow-left" class="btn_left"></span>
      <span id="arrow-right" class="btn_right"></span>
    </div>
</section>
<style>
.sentence_fragment {
    font-weight: bolder !important;
    font-size: 24px !important;
    font-family: 'Montserrat', sans-serif !important;
    margin-bottom: 10px !important;
    cursor: pointer !important;
    padding-left: 45px !important;
    padding-right: 45px !important;
    margin-bottom: 16px !important;
    width: auto !important;
    margin-left: 9px !important;
}

.row {
    margin-top: 11% !important;
}

.sentence > h3 {
    font-size: 34px !important;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: bolder !important;
}

.box {
    padding-bottom: 27px !important;
    padding-top: 25px !important;
    border-radius: 20px !important;
    padding-left: 2% !important;
    padding-right: 2% !important;
    width: 75% !important;
}

.box-orange {
    border: 3px solid #EB8D33 !important;
}

.box-blue {
    border: 5px solid #0097D7 !important;
    font-family: 'Montserrat', sans-serif;
    !important;
    font-size: 39px !important;
    font-weight: bolder !important;
    cursor: pointer !important;
}

.selection_item {
    padding: 10px 15px !important;
    background: #0097D7 !important;
    color: white !important;
    font-family: 'Montserrat', sans-serif !important;
    font-weight: bolder !important;
    font-size: 25px !important;
    border-radius: 20px !important;
}

.btn_done {
    background: #199cdd;
    background-image: -webkit-linear-gradient(top, #199cdd, #1079b2);
    background-image: -moz-linear-gradient(top, #199cdd, #1079b2);
    background-image: -ms-linear-gradient(top, #199cdd, #1079b2);
    background-image: -o-linear-gradient(top, #199cdd, #1079b2);
    background-image: linear-gradient(to bottom, #199cdd, #1079b2);
    -webkit-border-radius: 11;
    -moz-border-radius: 11;
    border-radius: 11px;
    -webkit-box-shadow: 0px 1px 3px #666666;
    -moz-box-shadow: 0px 1px 3px #666666;
    box-shadow: 0px 4px 0px #00678E;
    font-family: 'Montserrat', sans-serif;
    color: #ffffff;
    font-size: 30px;
    padding: 10px 55px 10px 55px;
    text-decoration: none;
    position: absolute;
    left: 52px;
    top: 250px;
}

.btn_done:hover {
    background: #3cb0fd;
    background-image: -webkit-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -moz-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -ms-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -o-linear-gradient(top, #3cb0fd, #3498db);
    background-image: linear-gradient(to bottom, #3cb0fd, #3498db);
    text-decoration: none;
}

.overlay_content {
    width: 80%;
    height: 81%;
    position: absolute;
    top: 80px;
    left: 145px;
    background: -moz-linear-gradient(top, #feed77 0%, #ee9b0f 100%);
    /* FF3.6+ */
    
    background: -webkit-gradient(linear, left top, left bottom, color-stop(0%, #feed77), color-stop(100%, #ee9b0f));
    /* Chrome,Safari4+ */
    
    background: -webkit-linear-gradient(top, #feed77 0%, #ee9b0f 100%);
    /* Chrome10+,Safari5.1+ */
    
    background: -o-linear-gradient(top, #feed77 0%, #ee9b0f 100%);
    /* Opera 11.10+ */
    
    background: -ms-linear-gradient(top, #feed77 0%, #ee9b0f 100%);
    /* IE10+ */
    
    background: linear-gradient(to bottom, #feed77 0%, #ee9b0f 100%);
    /* W3C */
}
</style>
<script>
(function() {
    status = 2;
    update_button();
    $('.btn_done').hide().hide();
    $('.overlay_in').hide().hide();
    $('.overlay_scoring').hide().hide();
    $('.btn_left').show();
    $('.counter').show();
    $('.btn_right').show();
    $('.solution').hide();
    var navigation_limit = 0;
    var current_navi = 1;
    var dataJSON
    var answer_word;
    var correct_answer_word;
    var parse_answer;
    var score = 0;
    var solution_bool;
    solution_bool = false;

    $.get("data/sentence_completion.php").success(function(data) {

        current_navi = 1;
        dataJSON = jQuery.parseJSON(data);
        navigation_limit = dataJSON[0].questions.length
        answer_word = [
            [],
            [],
            [],
            [],
            []
        ];
        correct_answer_word = [];
        parse_answer = [];
        console.log("asdasdasd" + correct_answer_word)
        $('.counter_last').html(navigation_limit);
        $('.counter_current').html(current_navi);
        $(".heading_text").text(dataJSON[0].instruction);

        for (i = 0; i < navigation_limit; i++) {
            answer_word[i] = [];
            correct_answer_word.push(dataJSON[0].questions[i].question_answer);
            console.log(correct_answer_word);
            parse_answer.push(" ");
        }
        set();


    });
    $('.btn_left').click(function() {
        if (current_navi > 1) {
            //decrement

            parse_answer[current_navi - 1] = $('#selection').text()
            current_navi--;
            //update question sentence class
        }
        $('.btn_done').hide();
        $('.counter_current').html(current_navi);
        set();
        if (answer_word[current_navi - 1] == "") {
            /*it means nothing*/
        } else {

            for (i = 0; i < answer_word[current_navi - 1].length; i++) {
                var button_name = answer_word[current_navi - 1][i];
                //create/append button
                $("#selection").append("   " + button_name);
                $('.btn_box_blue[data-index=' + button_name + ']').unbind("click");
                $('.btn_box_blue[data-index=' + button_name + ']').css('-webkit-filter', 'grayscale(100%)');

            }
        }
        check_solution(current_navi - 1);
    });
    $('.btn_right').click(function() {
        if (current_navi < navigation_limit) {
            //increment
            parse_answer[current_navi - 1] = $('#selection').text()
            current_navi++;
            //update question sentence class

        }
        if (current_navi == navigation_limit) {
            $('.btn_done').fadeIn().show();
        }
        $('.counter_current').html(current_navi);
        set();
        if (answer_word[current_navi - 1] == "") {
            /*it means nothing*/
        } else {
            for (i = 0; i < answer_word[current_navi - 1].length; i++) {
                var button_name = answer_word[current_navi - 1][i];


                // $('#selection').html(template);
                $("#selection").append("   " + button_name);
                $('.btn_box_blue[data-index=' + button_name + ']').unbind("click");
                $('.btn_box_blue[data-index=' + button_name + ']').css('-webkit-filter', 'grayscale(100%)');

            }
        }
        check_solution(current_navi - 1);

    });

    function set() {
        $('.col-xs-6').html('');
        $('#selection').html('');
        for (i = 0; i < dataJSON[0].questions[current_navi - 1].question_choice.length; i++) {

            var button_name = dataJSON[0].questions[current_navi - 1].question_choice[i];
            //create/append button
            $(".col-xs-6").append("<a href='#' class='sentence_fragment btn_box_blue' data-index=" + button_name + " >" + button_name + "</a>");
        }
        /*click*/
        $('.sentence_fragment').click(function() {
            $(this).css('-webkit-filter', 'grayscale(100%)');
            $(this).unbind("click");
            var template = "<div id='sentence'>" + $(this).text() + "</div>";
            // $('#selection').html(template);
            $("#selection").append("   " + $(this).text());
            answer_word[current_navi - 1].push($(this).text());
            //console.log(answer_word[current_navi-1]);

        });
    }
    $('.btn_done').click(function() {
        $('.overlay_in').fadeIn();
        parse_answer[current_navi - 1] = $('#selection').text()
    })
    $('.yes').click(function() {
        $('.overlay_in').hide();
        $('.overlay_scoring').fadeIn();
        checking();



    });
    $('.no').click(function() {
        $('.overlay_in').hide();
    });
    $('.close_btn').click(function() {
        $('.overlay_scoring').hide();
        current_navi = 1;
        //parse_answer[current_navi-1] = $('#selection').text()

        //update question sentence class

        if (current_navi == navigation_limit) {
            if (!solution_bool) {
                $('.btn_done').fadeIn().show();
            }
        }
        $('.counter_current').html(current_navi);
        set();
        if (answer_word[current_navi - 1] == "") {
            /*it means nothing*/
        } else {
            for (i = 0; i < answer_word[current_navi - 1].length; i++) {
                var button_name = answer_word[current_navi - 1][i];

                // $('#selection').html(template);
                $("#selection").append("   " + button_name);
                $('.btn_box_blue[data-index=' + button_name + ']').unbind();

                $('.btn_box_blue[data-index=' + button_name + ']').css('-webkit-filter', 'grayscale(100%)');

            }
        }
        $('.box.box-blue').unbind();
        solution_bool = true;
        check_solution(0);
    })

    function checking() {
        for (i = 0; i < navigation_limit; i++) {
            console.log(i + parse_answer[i], i + correct_answer_word[i])
            if (parse_answer[i].replace(/ /g, '') == correct_answer_word[i].replace(/ /g, '')) {
                score = score + 1;
            }
            set_score("" + score * 20)
        }
    }


    $('.box.box-blue').click(function() {
        for (i = 0; i < answer_word[current_navi - 1].length; i++) {
            var button_name = answer_word[current_navi - 1][i];

            $('.btn_box_blue[data-index=' + button_name + ']').css('-webkit-filter', 'grayscale(0%)');

        }
        answer_word[current_navi - 1] = [];
        $('.sentence_fragment').unbind("click");
        $('#selection').html('');
        $('.sentence_fragment').click(function() {
            $(this).css('-webkit-filter', 'grayscale(100%)');
            $(this).unbind("click");
            var template = "<div id='sentence'>" + $(this).text() + "</div>";
            // $('#selection').html(template);
            $("#selection").append("   " + $(this).text());
            answer_word[current_navi - 1].push($(this).text());
            //console.log(answer_word[current_navi-1]);
        });

    })

    function check_solution(i) {

        if (solution_bool) {
            $('.btn_box_blue').unbind();
            clearInterval(my_timer);
            $('.btn_box_blue').css('-webkit-filter', 'grayscale(100%)');
            console.log(i);
            $('.btn_done').hide();
            console.log(parse_answer[i].length, correct_answer_word[i])
            $('.solution').show();
            if (parse_answer[i].replace(/ /g, '') != correct_answer_word[i].replace(/ /g, '')) {
                //wrong
                //console.log("wrong");
                $('.solution').attr('src', 'abiva_assets/wrong.png');
            }
            if (parse_answer[i].replace(/ /g, '') == correct_answer_word[i].replace(/ /g, '')) {
                //correct
                //console.log("correct");
                $('.solution').attr('src', 'abiva_assets/correct.png');
            }
            if (parse_answer[i].length == 0) {
                //na
                // console.log("na");
                $('.solution').attr('src', 'abiva_assets/NA.png');
            }

        }
    }

    $('.third_activity').click(function() {
        clearInterval(my_timer);
    });
    var seconds = 0;
    var minutes = 0;
    var my_timer = setInterval(function() {
        seconds = seconds + 1;
        if (seconds > 59) {
            seconds = 0;
            minutes = minutes + 1;
        }
        if (seconds.toString().length == 1) {
            $('.timer').text(minutes + ":" + "0" + seconds)
        }
        if (minutes.toString().length == 1) {
            $('.timer').text("0" + minutes + ":" + seconds)
        }
        if (seconds.toString().length == 1 && minutes.toString().length == 1) {
            $('.timer').text("0" + minutes + ":" + "0" + seconds)
        }

    }, 1000)
})();
</script>
